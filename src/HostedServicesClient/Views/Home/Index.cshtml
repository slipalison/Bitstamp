<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>WebSocket Bitstamp</title>
</head>
<body>



    <main>
        <div class="container d-flex flex-column justify-content-center align-items-center" style="height: 70vh;">
            <h1>Produtos</h1>
            <p>Itens atualizados a cada 5 segundos via websocket.</p>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Produto </th>
                        <th>Preço minímo </th>
                        <th>Preço maximo</th>
                        <th>Quantidade media</th>
                        <th>Preço médio</th>
                        <th>Preço médio do ultimos 5s</th>
                    </tr>
                </thead>
                <tbody id="produtos">
                </tbody>
            </table>
        </div>
    </main>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/websocket")
            .build();

        connection.start()
            .then(() => {
                console.log("WebSocket connection established.");

                connection.on("AtualizarProdutos", (produtos) => {
                    $("#produtos").empty();
                    $("#produtos").append(`<tr>
                    <td>BTC Bids</td>
                    <td>USD $ ${produtos.btcBid.minPrice}</td>
                    <td>USD $ ${produtos.btcBid.maxPrice}</td>
                    <td>BTC ${produtos.btcBid.mediaAmount}</td>
                    <td>USD $ ${produtos.btcBid.mediaPrice}</td>
                    <td>USD $ ${produtos.btcBid.mediaPrice5.toFixed(2)}</td>
                    </tr>
                    <tr>
                    <td>BTC Asks</td>
                    <td>USD $ ${produtos.btcAsk.minPrice}</td>
                    <td>USD $ ${produtos.btcAsk.maxPrice}</td>
                    <td>BTC ${produtos.btcAsk.mediaAmount}</td>
                    <td>USD $ ${produtos.btcAsk.mediaPrice}</td>
                    <td>USD $ ${produtos.btcAsk.mediaPrice5.toFixed(2)}</td>
                    </tr>
                    <tr>
                    <td>ETH Bids</td>
                            <td>USD $ ${produtos.ethBid.minPrice}</td>
                    <td>USD $ ${produtos.ethBid.maxPrice}</td>
                    <td>ETH ${produtos.ethBid.mediaAmount}</td>
                    <td>USD $ ${produtos.ethBid.mediaPrice}</td>
                    <td>USD $ ${produtos.ethBid.mediaPrice5.toFixed(2)}</td>
                    </tr>
                    <tr>
                    <td>ETH Asks</td>
                    <td>USD $ ${produtos.ethAsk.minPrice}</td>
                    <td>USD $ ${produtos.ethAsk.maxPrice}</td>
                    <td>ETH ${produtos.ethAsk.mediaAmount}</td>
                    <td>USD $ ${produtos.ethAsk.mediaPrice}</td>
                    <td>USD $ ${produtos.ethAsk.mediaPrice5.toFixed(2)}</td>
                    </tr>`);
                });
            })
            .catch((error) => {
                console.error(error);
            });
    </script>
</body>
</html>
